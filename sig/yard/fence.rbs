module Yard
  module Fence
    # Constants (refined literal types where possible)
    VERSION: String
    ASCII_BRACES: "{}"
    FULLWIDTH_BRACES: "｛｝"
    KRAMDOWN_PROVIDER: { lib: Symbol, const: String }
    GLOB_PATTERN: String
    TRIPLE_TICK_FENCE: ::Regexp
    INLINE_TICK_FENCE: ::Regexp
    DOUBLE_BRACE_PLACEHOLDER_REGEX: ::Regexp
    SINGLE_BRACE_PLACEHOLDER_REGEX: ::Regexp

    # Error class
    class Error < ::StandardError
    end

    # Module functions (available both as singleton and instance via module_function)
    def self.fullwidth_braces: (String str) -> String
    def fullwidth_braces: (String str) -> String

    def self.sanitize_inline_code: (String line) -> String
    def sanitize_inline_code: (String line) -> String

    def self.sanitize_fenced_blocks: (String text) -> String
    def sanitize_fenced_blocks: (String text) -> String

    # Accept any object; if String returns String, otherwise returns original (untyped)
    def self.sanitize_text: (String text) -> String
                          | (untyped text) -> untyped
    def sanitize_text: (String text) -> String
                     | (untyped text) -> untyped

    def self.prepare_tmp_files: () -> void
    def prepare_tmp_files: () -> void

    def self.restore_ascii_braces_in_html_file: (String html_filepath) -> void
    def restore_ascii_braces_in_html_file: (String html_filepath) -> void

    def self.postprocess_html_docs: () -> void
    def postprocess_html_docs: () -> void

    def self.use_kramdown_gfm!: () -> bool
    def use_kramdown_gfm!: () -> bool

    module Version
      VERSION: String
    end

    class KramdownGfmDocument < ::Kramdown::Document
      # From implementation: stores original source and forces GFM input by default
      UNRENDERED_FENCE_PARAGRAPH: ::Regexp
      DETAILS_MARKDOWN_1: ::Regexp

      def initialize: (String source, ?Hash[Symbol, untyped] options) -> void

      # Public API
      def to_html: () -> String

      private

      def needs_fallback?: (String html) -> bool
      def fallback_improved?: (String fb_html) -> bool
    end
  end
end

# Top-level alias used by YARD's constant resolution (see ruby implementation)
KramdownGfmDocument: Yard::Fence::KramdownGfmDocument
